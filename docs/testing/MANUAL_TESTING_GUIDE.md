# 手動測試指南 - 文章列表跳動問題修復

**測試目標**: 驗證文章列表在點擊文章或儲存後不會跳動到第一項

**測試版本**: Phase 1B 完成後
**測試日期**: 2026-01-27
**相關 Bug**: docs/fix-bug/2026-01-26-article-list-issues-root-cause.md

---

## 測試前準備

1. **確保應用程式已重新編譯**:
   ```bash
   pnpm run build
   # 或
   pnpm run dev
   ```

2. **確保有足夠的測試文章**:
   - 至少 20 篇文章（確保列表可以滾動）
   - 文章分散在不同分類中

3. **開啟開發者工具**:
   - 打開 Console 以觀察日誌
   - 檢查是否有錯誤訊息

---

## 測試場景

### ✅ 場景 1: 點擊文章後列表位置保持

**重現步驟**:
1. 打開應用程式，進入文章列表視圖
2. 確保列表中有至少 20 篇文章（足以產生滾動）
3. 滾動列表到中間位置（例如第 10 篇文章）
4. 記住當前滾動位置（可以用眼睛看或截圖）
5. 點擊某篇文章進入編輯器
6. 等待 6-10 秒（檔案監聽觸發的時間）
7. 觀察列表位置

**預期結果**:
- ✅ 列表位置**不應該**跳動到第一項
- ✅ 列表應該保持在原本的滾動位置
- ✅ Console 應該顯示類似訊息:
  ```
  FileWatchService: 忽略檔案變化（已標記忽略）: C:/path/to/article.md
  ```

**失敗結果**:
- ❌ 列表自動滾動到頂部（第一篇文章）
- ❌ Console 顯示重新載入文章的訊息

---

### ✅ 場景 2: 編輯並儲存後列表位置保持

**重現步驟**:
1. 進入文章列表，滾動到中間位置
2. 點擊一篇文章進入編輯器
3. 修改文章內容（例如加一行文字）
4. 儲存文章（Ctrl+S 或點擊儲存按鈕）
5. 等待 6-10 秒
6. 返回文章列表視圖（或觀察側邊欄的列表）
7. 檢查列表位置

**預期結果**:
- ✅ 列表位置保持不變
- ✅ 文章內容已更新（檢查 lastModified 時間）
- ✅ Console 顯示:
  ```
  FileWatchService: 標記忽略檔案: C:/path/to/article.md (持續 5000ms)
  FileWatchService: 忽略檔案變化（已標記忽略）: C:/path/to/article.md
  ```
- ✅ 沒有重複的文章項目

**失敗結果**:
- ❌ 列表跳到頂部
- ❌ 出現重複的文章項目
- ❌ Console 顯示 `reloadArticleByPath` 訊息（此函數已移除）

---

### ✅ 場景 3: 外部編輯器修改文章（應該同步）

**重現步驟**:
1. 在應用程式中打開文章列表
2. 用外部編輯器（如 VS Code, Notepad++）打開某篇文章
3. 修改文章內容並儲存
4. 等待 2-5 秒
5. 檢查應用程式中的文章列表和內容

**預期結果**:
- ✅ 文章內容在應用程式中自動更新
- ✅ Console 顯示:
  ```
  檔案變化：change - C:/path/to/article.md
  ```
- ✅ 顯示通知：「檔案已更新 - 外部修改已同步」
- ✅ **列表順序不應改變**

**失敗結果**:
- ❌ 內容沒有更新
- ❌ 列表順序改變
- ❌ 出現重複項目

---

### ✅ 場景 4: 外部新增文章（應該同步）

**重現步驟**:
1. 在應用程式中查看文章列表，記住文章數量
2. 用外部方式在 Vault 中新增一篇文章:
   ```
   C:/path/to/vault/Drafts/Software/new-test-article.md
   ```
   內容:
   ```markdown
   ---
   title: 測試新增文章
   date: 2026-01-27
   tags: []
   categories: [Software]
   ---

   這是測試內容
   ```
3. 等待 2-5 秒
4. 檢查應用程式

**預期結果**:
- ✅ 文章列表增加一筆
- ✅ 新文章顯示在正確的位置（依排序規則）
- ✅ Console 顯示:
  ```
  檔案變化：add - C:/path/to/vault/Drafts/Software/new-test-article.md
  ```
- ✅ 顯示通知：「新增文章 - 偵測到新文章：測試新增文章」

**失敗結果**:
- ❌ 文章沒有出現
- ❌ 出現多個重複的新文章

---

### ✅ 場景 5: 外部刪除文章（應該同步）

**重現步驟**:
1. 在應用程式中記住某篇文章的標題
2. 用外部方式刪除該文章的 .md 檔案
3. 等待 2-5 秒
4. 檢查應用程式

**預期結果**:
- ✅ 文章從列表中消失
- ✅ Console 顯示:
  ```
  檔案變化：unlink - C:/path/to/deleted-article.md
  ```
- ✅ 顯示通知：「文章已移除 - 偵測到文章被刪除：[標題]」
- ✅ 如果該文章正在編輯，應該清空編輯器或顯示提示

**失敗結果**:
- ❌ 文章仍然顯示在列表中
- ❌ 點擊該文章時出錯

---

### ✅ 場景 6: 快速連續操作（壓力測試）

**重現步驟**:
1. 快速點擊多篇文章（每 0.5 秒點擊一次）
2. 快速編輯並儲存多篇文章
3. 觀察列表行為和 Console 訊息

**預期結果**:
- ✅ 列表位置穩定，不會跳動
- ✅ Console 顯示多個「標記忽略檔案」訊息
- ✅ 沒有錯誤訊息
- ✅ 沒有重複文章

**失敗結果**:
- ❌ 列表快速跳動
- ❌ 出現錯誤訊息
- ❌ 應用程式卡頓或崩潰

---

### ✅ 場景 7: 分頁保持（如果有分頁功能）

**重現步驟**:
1. 如果列表有分頁，切換到第 2 頁或第 3 頁
2. 點擊一篇文章
3. 等待 6 秒
4. 返回列表視圖

**預期結果**:
- ✅ 當前頁碼保持不變
- ✅ 列表位置保持在當前頁

**失敗結果**:
- ❌ 自動跳回第 1 頁

---

## 除錯資訊收集

如果測試失敗，請收集以下資訊：

### Console 日誌
複製所有相關的 Console 訊息，特別是：
- `FileWatchService:` 開頭的訊息
- `檔案變化：` 訊息
- 錯誤堆疊追蹤

### 複現步驟
詳細記錄：
1. 具體操作步驟
2. 預期結果 vs 實際結果
3. 是否穩定複現（100%？50%？偶爾？）

### 環境資訊
- 作業系統版本
- 應用程式版本/Commit
- Vault 路徑格式（正斜線/反斜線）
- 文章數量

---

## 測試結果記錄

| 場景 | 狀態 | 備註 |
|------|------|------|
| 場景 1: 點擊文章後列表位置保持 | ⬜ 通過 / ⬜ 失敗 | |
| 場景 2: 編輯並儲存後列表位置保持 | ⬜ 通過 / ⬜ 失敗 | |
| 場景 3: 外部編輯器修改文章 | ⬜ 通過 / ⬜ 失敗 | |
| 場景 4: 外部新增文章 | ⬜ 通過 / ⬜ 失敗 | |
| 場景 5: 外部刪除文章 | ⬜ 通過 / ⬜ 失敗 | |
| 場景 6: 快速連續操作 | ⬜ 通過 / ⬜ 失敗 | |
| 場景 7: 分頁保持 | ⬜ 通過 / ⬜ 失敗 | |

---

## 測試完成後

### ✅ 如果所有測試通過
1. 更新 Bug Fix 報告，標記為「已驗證修復」
2. 合併分支到 `develop`
3. 更新 REFACTORING_PLAN.md，標記 Phase 2 完成

### ❌ 如果有測試失敗
1. 在 Bug Fix 報告中補充「追加修復」章節
2. 記錄失敗的場景和原因分析
3. 在同一個 `fix/` 分支繼續修復
4. 修復後重新測試

---

**測試人員**: ___________
**測試日期**: ___________
**測試結果**: ⬜ 通過 / ⬜ 失敗
**備註**: ___________
