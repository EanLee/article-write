# æ¶æ§‹è¨­è¨ˆæ–‡ä»¶

> åŸºæ–¼ PRODUCT_SPEC.md çš„æŠ€è¡“æ¶æ§‹èªªæ˜

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Electron App                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   æ–‡ç« ç®¡ç†    â”‚  â”‚   ç·¨è¼¯å™¨     â”‚  â”‚  ç™¼å¸ƒå·¥å…·    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                 â”‚                  â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Service Layer                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚Converter   â”‚  â”‚ Git        â”‚  â”‚ Publish    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚Service     â”‚  â”‚ Service    â”‚  â”‚ Service    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚         â”‚                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚        Blog Adapter (æŠ½è±¡å±¤)         â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  â”‚Astro â”‚  â”‚ Hugo â”‚  â”‚ Hexo â”‚ ...  â”‚         â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜      â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                     â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚æ–‡ç« åº«    â”‚                          â”‚éƒ¨è½æ ¼å°ˆæ¡ˆâ”‚
    â”‚(ç”¨æˆ¶ç®¡ç†)â”‚                          â”‚(Git Repo)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ è³‡æ–™å¤¾çµæ§‹åˆ†é›¢

### ç”¨æˆ¶æ–‡ç« åº«ï¼ˆè‡ªç”±é¸æ“‡ä½ç½®ï¼‰

```
~/my-articles/              â† ç”¨æˆ¶å¯è‡ªç”±é¸æ“‡
â”œâ”€â”€ articles/
â”‚   â”œâ”€â”€ article-1.md        â† åŒ…å« Wiki Links [[]]
â”‚   â”œâ”€â”€ article-2.md
â”‚   â””â”€â”€ draft-article.md
â”œâ”€â”€ images/                 â† çµ±ä¸€åœ–ç‰‡ç›®éŒ„
â”‚   â”œâ”€â”€ screenshot-1.png
â”‚   â””â”€â”€ diagram-2.png
â””â”€â”€ .git (å¯é¸)             â† ç”¨æˆ¶å¯é¸æ“‡æ˜¯å¦ç‰ˆæœ¬æ§åˆ¶
```

### éƒ¨è½æ ¼å°ˆæ¡ˆï¼ˆAstro/Hugo/...ï¼‰

```
~/my-blog/                  â† éœæ…‹ç¶²ç«™å°ˆæ¡ˆ
â”œâ”€â”€ src/content/blog/
â”‚   â”œâ”€â”€ article-1/
â”‚   â”‚   â”œâ”€â”€ index.md        â† æ¨™æº– Markdownï¼ˆç„¡ Wiki Linksï¼‰
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”‚       â””â”€â”€ screenshot-1.png
â”‚   â””â”€â”€ article-2/
â”‚       â””â”€â”€ index.md
â””â”€â”€ .git                    â† éƒ¨è½æ ¼çš„ Git å€‰åº«
```

**é—œéµåˆ†é›¢é»**ï¼š
- å¯«ä½œæ™‚ä½¿ç”¨ Wiki Links â†’ è‡ªç”±
- ç™¼å¸ƒæ™‚è½‰æ›ç‚ºæ¨™æº– Markdown â†’ ç›¸å®¹
- åœ–ç‰‡é›†ä¸­ç®¡ç† â†’ ç™¼å¸ƒæ™‚è‡ªå‹•åˆ†é…

---

## ğŸ”Œ Adapter æ¨¡å¼è¨­è¨ˆ

### æ ¸å¿ƒä»‹é¢

```typescript
// src/services/adapters/BlogAdapter.ts

export interface BlogAdapter {
  /** Adapter åç¨± */
  name: string

  /**
   * è½‰æ› Wiki Link ç‚ºè©²æ¡†æ¶æ”¯æ´çš„æ ¼å¼
   * @param link - Wiki Link æ–‡å­—ï¼ˆä¸å« [[]]ï¼‰
   * @param displayText - é¡¯ç¤ºæ–‡å­—ï¼ˆå¦‚æœæœ‰ | åˆ†éš”ï¼‰
   * @param allArticles - æ‰€æœ‰æ–‡ç« åˆ—è¡¨ï¼ˆç”¨æ–¼é©—è­‰é€£çµå­˜åœ¨ï¼‰
   * @returns è½‰æ›å¾Œçš„ Markdown é€£çµ
   */
  convertWikiLink(
    link: string,
    displayText: string | null,
    allArticles: Article[]
  ): string

  /**
   * è½‰æ›åœ–ç‰‡å¼•ç”¨ç‚ºè©²æ¡†æ¶æ”¯æ´çš„æ ¼å¼
   * @param imageName - åœ–ç‰‡æª”å
   * @returns è½‰æ›å¾Œçš„åœ–ç‰‡èªæ³•
   */
  convertImageReference(imageName: string): string

  /**
   * è½‰æ› Frontmatter ç‚ºè©²æ¡†æ¶è¦æ±‚çš„æ ¼å¼
   * @param frontmatter - é€šç”¨ Frontmatter
   * @returns æ¡†æ¶ç‰¹å®šçš„ Frontmatter
   */
  convertFrontmatter(frontmatter: Frontmatter): Record<string, any>

  /**
   * å–å¾—æ–‡ç« åœ¨éƒ¨è½æ ¼å°ˆæ¡ˆä¸­çš„ç›®æ¨™è·¯å¾‘
   * @param article - æ–‡ç« è³‡æ–™
   * @param blogRepo - éƒ¨è½æ ¼å°ˆæ¡ˆæ ¹ç›®éŒ„
   * @returns å®Œæ•´çš„ç›®æ¨™æª”æ¡ˆè·¯å¾‘
   */
  getArticleTargetPath(article: Article, blogRepo: string): string

  /**
   * å–å¾—åœ–ç‰‡åœ¨éƒ¨è½æ ¼å°ˆæ¡ˆä¸­çš„ç›®æ¨™è·¯å¾‘
   * @param article - æ‰€å±¬æ–‡ç« 
   * @param imageName - åœ–ç‰‡æª”å
   * @param blogRepo - éƒ¨è½æ ¼å°ˆæ¡ˆæ ¹ç›®éŒ„
   * @returns å®Œæ•´çš„ç›®æ¨™åœ–ç‰‡è·¯å¾‘
   */
  getImageTargetPath(
    article: Article,
    imageName: string,
    blogRepo: string
  ): string

  /**
   * é©—è­‰éƒ¨è½æ ¼å°ˆæ¡ˆçµæ§‹æ˜¯å¦æ­£ç¢º
   * @param blogRepo - éƒ¨è½æ ¼å°ˆæ¡ˆæ ¹ç›®éŒ„
   * @returns é©—è­‰çµæœ
   */
  validateBlogStructure(blogRepo: string): Promise<ValidationResult>
}
```

### Astro Adapter å¯¦ä½œ

```typescript
// src/services/adapters/AstroAdapter.ts

export class AstroAdapter implements BlogAdapter {
  name = 'Astro'

  convertWikiLink(
    link: string,
    displayText: string | null,
    allArticles: Article[]
  ): string {
    const slug = this.generateSlug(link)
    const text = displayText || link
    return `[${text}](../${slug}/)`
  }

  convertImageReference(imageName: string): string {
    return `![${imageName}](./images/${imageName})`
  }

  convertFrontmatter(fm: Frontmatter): Record<string, any> {
    return {
      title: fm.title,
      description: fm.description || '',
      pubDate: fm.pubDate,
      tags: fm.tags || [],
      // Astro ç‰¹å®šæ¬„ä½
      draft: fm.status === 'draft',
      ...(fm.series && {
        series: fm.series,
        seriesOrder: fm.seriesOrder
      })
    }
  }

  getArticleTargetPath(article: Article, blogRepo: string): string {
    const slug = this.generateSlug(article.title)
    return path.join(blogRepo, 'src/content/blog', slug, 'index.md')
  }

  getImageTargetPath(
    article: Article,
    imageName: string,
    blogRepo: string
  ): string {
    const slug = this.generateSlug(article.title)
    return path.join(blogRepo, 'src/content/blog', slug, 'images', imageName)
  }

  async validateBlogStructure(blogRepo: string): Promise<ValidationResult> {
    const contentPath = path.join(blogRepo, 'src/content/blog')
    const exists = await fs.pathExists(contentPath)

    if (!exists) {
      return {
        valid: false,
        message: 'æ‰¾ä¸åˆ° src/content/blog ç›®éŒ„ï¼Œè«‹ç¢ºèªæ˜¯ Astro å°ˆæ¡ˆ'
      }
    }

    return { valid: true, message: 'Astro å°ˆæ¡ˆçµæ§‹æ­£ç¢º' }
  }

  private generateSlug(title: string): string {
    // Slug ç”Ÿæˆé‚è¼¯
    return title
      .toLowerCase()
      .replace(/\s+/g, '-')
      .replace(/[^a-z0-9-]/g, '')
  }
}
```

### æœªä¾†æ“´å±•ï¼šHugo Adapter

```typescript
// src/services/adapters/HugoAdapter.ts

export class HugoAdapter implements BlogAdapter {
  name = 'Hugo'

  convertWikiLink(link: string, displayText: string | null): string {
    const slug = this.generateSlug(link)
    const text = displayText || link
    // Hugo ä½¿ç”¨çµ•å°è·¯å¾‘
    return `[${text}](/${slug}/)`
  }

  convertImageReference(imageName: string): string {
    // Hugo åœ–ç‰‡æ”¾åœ¨ static/ æˆ–ä½¿ç”¨ Page Resources
    return `![${imageName}](images/${imageName})`
  }

  getArticleTargetPath(article: Article, blogRepo: string): string {
    const slug = this.generateSlug(article.title)
    // Hugo ä½¿ç”¨ content/posts/
    return path.join(blogRepo, 'content/posts', slug, 'index.md')
  }

  // ... å…¶ä»–æ–¹æ³•
}
```

---

## ğŸ”„ è½‰æ›æµç¨‹

### å®Œæ•´ç™¼å¸ƒæµç¨‹

```typescript
// src/services/PublishService.ts

export class PublishService {
  constructor(
    private adapter: BlogAdapter,
    private converter: ConverterService,
    private git: GitService,
    private fileService: FileService
  ) {}

  async publish(
    article: Article,
    config: AppConfig
  ): Promise<PublishResult> {
    const steps: PublishStep[] = []

    try {
      // Step 1: é©—è­‰
      steps.push({ name: 'é©—è­‰è¨­å®š', status: 'running' })
      await this.validateConfig(config)
      steps[0].status = 'completed'

      // Step 2: è½‰æ›å…§å®¹
      steps.push({ name: 'è½‰æ› Wiki Links', status: 'running' })
      const convertedContent = await this.convertContent(article)
      steps[1].status = 'completed'

      // Step 3: è™•ç†åœ–ç‰‡
      steps.push({ name: 'è¤‡è£½åœ–ç‰‡', status: 'running' })
      await this.processImages(article, config)
      steps[2].status = 'completed'

      // Step 4: å¯«å…¥éƒ¨è½æ ¼å°ˆæ¡ˆ
      steps.push({ name: 'å¯«å…¥æª”æ¡ˆ', status: 'running' })
      const targetPath = this.adapter.getArticleTargetPath(
        article,
        config.paths.blogRepo
      )
      await this.fileService.writeFile(targetPath, convertedContent)
      steps[3].status = 'completed'

      // Step 5: Git æ“ä½œ
      steps.push({ name: 'Git Commit', status: 'running' })
      await this.git.add(config.paths.blogRepo, ['.'])
      await this.git.commit(
        config.paths.blogRepo,
        `publish: ${article.title}`
      )
      steps[4].status = 'completed'

      steps.push({ name: 'Git Push', status: 'running' })
      await this.git.push(config.paths.blogRepo)
      steps[5].status = 'completed'

      return {
        success: true,
        steps,
        message: 'ç™¼å¸ƒæˆåŠŸï¼'
      }

    } catch (error) {
      return {
        success: false,
        steps,
        error: error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'
      }
    }
  }

  private async convertContent(article: Article): Promise<string> {
    let content = article.content

    // è½‰æ› Wiki Links
    content = this.convertWikiLinks(content)

    // è½‰æ›åœ–ç‰‡
    content = this.convertImages(content)

    // è½‰æ› Frontmatter
    const frontmatter = this.adapter.convertFrontmatter(article.frontmatter)

    // çµ„åˆæœ€çµ‚å…§å®¹
    return `---\n${yaml.stringify(frontmatter)}---\n\n${content}`
  }

  private convertWikiLinks(content: string): string {
    // è™•ç† [[link|display]] æ ¼å¼
    content = content.replace(
      /\[\[([^|\]]+)\|([^\]]+)\]\]/g,
      (_, link, display) => this.adapter.convertWikiLink(link, display, this.articles)
    )

    // è™•ç† [[link]] æ ¼å¼
    content = content.replace(
      /\[\[([^\]]+)\]\]/g,
      (_, link) => this.adapter.convertWikiLink(link, null, this.articles)
    )

    return content
  }

  private convertImages(content: string): string {
    return content.replace(
      /!\[\[([^\]]+)\]\]/g,
      (_, imageName) => this.adapter.convertImageReference(imageName)
    )
  }

  private async processImages(
    article: Article,
    config: AppConfig
  ): Promise<void> {
    // æå–æ‰€æœ‰åœ–ç‰‡å¼•ç”¨
    const imageRefs = this.extractImageReferences(article.content)

    for (const imageName of imageRefs) {
      const sourcePath = path.join(config.paths.imagesDir, imageName)
      const targetPath = this.adapter.getImageTargetPath(
        article,
        imageName,
        config.paths.blogRepo
      )

      // è¤‡è£½åœ–ç‰‡
      await this.fileService.copy(sourcePath, targetPath)
    }
  }
}
```

---

## ğŸ”§ Git è‡ªå‹•åŒ–è¨­è¨ˆ

### Git Service

```typescript
// src/services/GitService.ts

export class GitService {
  /**
   * åœ¨æŒ‡å®šå€‰åº«åŸ·è¡Œ Git æ“ä½œ
   */
  async executeInRepo<T>(
    repoPath: string,
    operation: () => Promise<T>
  ): Promise<T> {
    const originalCwd = process.cwd()
    try {
      process.chdir(repoPath)
      return await operation()
    } finally {
      process.chdir(originalCwd)
    }
  }

  async add(repoPath: string, files: string[]): Promise<void> {
    await this.executeInRepo(repoPath, async () => {
      const git = simpleGit()
      await git.add(files)
    })
  }

  async commit(repoPath: string, message: string): Promise<void> {
    await this.executeInRepo(repoPath, async () => {
      const git = simpleGit()
      await git.commit(message)
    })
  }

  async push(repoPath: string, remote = 'origin', branch?: string): Promise<void> {
    await this.executeInRepo(repoPath, async () => {
      const git = simpleGit()

      // å¦‚æœæ²’æŒ‡å®š branchï¼Œä½¿ç”¨ç•¶å‰åˆ†æ”¯
      if (!branch) {
        const status = await git.status()
        branch = status.current
      }

      await git.push(remote, branch)
    })
  }

  async getStatus(repoPath: string): Promise<GitStatus> {
    return await this.executeInRepo(repoPath, async () => {
      const git = simpleGit()
      const status = await git.status()

      return {
        current: status.current,
        modified: status.modified,
        created: status.created,
        deleted: status.deleted,
        isClean: status.isClean()
      }
    })
  }

  async hasUncommittedChanges(repoPath: string): Promise<boolean> {
    const status = await this.getStatus(repoPath)
    return !status.isClean
  }
}
```

### éŒ¯èª¤è™•ç†èˆ‡å›æ»¾

```typescript
// src/services/PublishService.ts

async publish(article: Article, config: AppConfig): Promise<PublishResult> {
  const backup = await this.createBackup(config.paths.blogRepo)

  try {
    await this.performPublish(article, config)
    return { success: true }
  } catch (error) {
    // ç™¼ç”ŸéŒ¯èª¤æ™‚å›æ»¾
    await this.rollback(backup)
    throw error
  }
}

private async createBackup(blogRepo: string): Promise<Backup> {
  // è¨˜éŒ„ç›®å‰çš„ Git ç‹€æ…‹
  const status = await this.git.getStatus(blogRepo)
  return {
    repoPath: blogRepo,
    originalStatus: status
  }
}

private async rollback(backup: Backup): Promise<void> {
  // å¦‚æœæœ‰æœªæäº¤çš„è®Šæ›´ï¼Œå¾©åŸå®ƒå€‘
  await this.git.executeInRepo(backup.repoPath, async () => {
    const git = simpleGit()
    await git.reset(['--hard'])
  })
}
```

---

## ğŸ¨ UI å±¤è¨­è¨ˆ

### ç™¼å¸ƒæŒ‰éˆ•èˆ‡é€²åº¦é¡¯ç¤º

```vue
<!-- src/components/PublishButton.vue -->

<template>
  <div>
    <button
      @click="handlePublish"
      :disabled="isPublishing"
      class="btn btn-primary"
    >
      <Upload v-if="!isPublishing" :size="16" />
      <Loader v-else :size="16" class="animate-spin" />
      {{ isPublishing ? 'ç™¼å¸ƒä¸­...' : 'ç™¼å¸ƒåˆ°éƒ¨è½æ ¼' }}
    </button>

    <!-- ç™¼å¸ƒé€²åº¦ Modal -->
    <div v-if="showProgress" class="modal modal-open">
      <div class="modal-box">
        <h3 class="font-bold text-lg">ç™¼å¸ƒé€²åº¦</h3>

        <div class="space-y-2 mt-4">
          <div
            v-for="step in publishSteps"
            :key="step.name"
            class="flex items-center gap-2"
          >
            <Check v-if="step.status === 'completed'" class="text-success" />
            <Loader v-else-if="step.status === 'running'" class="animate-spin" />
            <Circle v-else class="text-base-content/30" />
            <span>{{ step.name }}</span>
          </div>
        </div>

        <div v-if="publishError" class="alert alert-error mt-4">
          {{ publishError }}
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useArticleStore } from '@/stores/article'
import { useConfigStore } from '@/stores/config'
import { publishService } from '@/services'

const articleStore = useArticleStore()
const configStore = useConfigStore()

const isPublishing = ref(false)
const showProgress = ref(false)
const publishSteps = ref<PublishStep[]>([])
const publishError = ref<string>()

async function handlePublish() {
  const currentArticle = articleStore.currentArticle
  if (!currentArticle) return

  isPublishing.value = true
  showProgress.value = true
  publishError.value = undefined

  try {
    const result = await publishService.publish(
      currentArticle,
      configStore.config
    )

    publishSteps.value = result.steps

    if (!result.success) {
      publishError.value = result.error || 'ç™¼å¸ƒå¤±æ•—'
    } else {
      // æˆåŠŸæç¤º
      setTimeout(() => {
        showProgress.value = false
      }, 2000)
    }
  } catch (error) {
    publishError.value = error instanceof Error
      ? error.message
      : 'æœªçŸ¥éŒ¯èª¤'
  } finally {
    isPublishing.value = false
  }
}
</script>
```

---

## ğŸ“Š é…ç½®ç®¡ç†

### æ–°çš„é…ç½®çµæ§‹

```typescript
// src/types/index.ts

export interface AppConfig {
  // è·¯å¾‘è¨­å®š
  paths: {
    /** æ–‡ç« ç›®éŒ„ï¼ˆç”¨æˆ¶çš„ Markdown æ–‡ç« å­˜æ”¾ä½ç½®ï¼‰ */
    contentDir: string

    /** éƒ¨è½æ ¼å°ˆæ¡ˆè·¯å¾‘ï¼ˆGit å€‰åº«ï¼‰ */
    blogRepo: string

    /** åœ–ç‰‡ç›®éŒ„ï¼ˆé è¨­ç‚º contentDir/imagesï¼‰ */
    imagesDir: string
  }

  // éƒ¨è½æ ¼è¨­å®š
  blog: {
    /** éƒ¨è½æ ¼é¡å‹ */
    type: 'astro' | 'hugo' | 'hexo' | 'jekyll' | 'custom'

    /** è‡ªè¨‚è¨­å®šï¼ˆç•¶ type ç‚º custom æ™‚ä½¿ç”¨ï¼‰ */
    custom?: {
      contentPath: string      // éƒ¨è½æ ¼å…§å®¹ç›®éŒ„ï¼ˆç›¸å°æ–¼ blogRepoï¼‰
      imagePath: string        // åœ–ç‰‡è·¯å¾‘æ ¼å¼
      linkFormat: string       // é€£çµæ ¼å¼ï¼ˆæ”¯æ´è®Šæ•¸ï¼‰
    }
  }

  // Git è¨­å®š
  git: {
    /** æ˜¯å¦è‡ªå‹• commit */
    autoCommit: boolean

    /** æ˜¯å¦è‡ªå‹• push */
    autoPush: boolean

    /** Commit message æ¨¡æ¿ */
    commitTemplate: string  // é è¨­: "publish: {title}"

    /** é ç«¯å€‰åº«åç¨± */
    remote: string  // é è¨­: "origin"
  }

  // ç·¨è¼¯å™¨è¨­å®š
  editorConfig: {
    autoSave: boolean
    autoSaveInterval: number
    theme: 'light' | 'dark'
  }
}
```

### é…ç½®é·ç§»

```typescript
// src/services/ConfigMigration.ts

export class ConfigMigration {
  /**
   * å¾èˆŠç‰ˆé…ç½®é·ç§»åˆ°æ–°ç‰ˆ
   */
  migrate(oldConfig: any): AppConfig {
    return {
      paths: {
        contentDir: oldConfig.paths?.obsidianVault || '',
        blogRepo: oldConfig.paths?.targetBlog || '',
        imagesDir: oldConfig.paths?.imagesDir || ''
      },
      blog: {
        type: 'astro',  // é è¨­ç‚º Astro
        custom: undefined
      },
      git: {
        autoCommit: true,
        autoPush: true,
        commitTemplate: 'publish: {title}',
        remote: 'origin'
      },
      editorConfig: oldConfig.editorConfig || {
        autoSave: true,
        autoSaveInterval: 30000,
        theme: 'light'
      }
    }
  }
}
```

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### å–®å…ƒæ¸¬è©¦

```typescript
// src/services/adapters/__tests__/AstroAdapter.spec.ts

describe('AstroAdapter', () => {
  let adapter: AstroAdapter

  beforeEach(() => {
    adapter = new AstroAdapter()
  })

  describe('convertWikiLink', () => {
    it('should convert simple wiki link', () => {
      const result = adapter.convertWikiLink('My Article', null, [])
      expect(result).toBe('[My Article](../my-article/)')
    })

    it('should convert wiki link with display text', () => {
      const result = adapter.convertWikiLink('My Article', 'Read this', [])
      expect(result).toBe('[Read this](../my-article/)')
    })
  })

  describe('convertImageReference', () => {
    it('should convert image reference', () => {
      const result = adapter.convertImageReference('screenshot.png')
      expect(result).toBe('![screenshot.png](./images/screenshot.png)')
    })
  })
})
```

### æ•´åˆæ¸¬è©¦

```typescript
// src/services/__tests__/PublishService.integration.spec.ts

describe('PublishService Integration', () => {
  it('should publish article successfully', async () => {
    // è¨­å®šæ¸¬è©¦ç’°å¢ƒ
    const testArticle = createTestArticle()
    const testConfig = createTestConfig()

    // åŸ·è¡Œç™¼å¸ƒ
    const result = await publishService.publish(testArticle, testConfig)

    // é©—è­‰çµæœ
    expect(result.success).toBe(true)

    // é©—è­‰æª”æ¡ˆå·²è¤‡è£½
    const targetFile = path.join(
      testConfig.paths.blogRepo,
      'src/content/blog',
      'test-article',
      'index.md'
    )
    expect(await fs.pathExists(targetFile)).toBe(true)

    // é©—è­‰å…§å®¹å·²è½‰æ›
    const content = await fs.readFile(targetFile, 'utf-8')
    expect(content).not.toContain('[[')  // Wiki Links å·²è½‰æ›
  })
})
```

---

## ğŸ“ ç¸½çµ

### è¨­è¨ˆåŸå‰‡

1. **åˆ†é›¢é—œæ³¨é»**ï¼šæ–‡ç« åº«èˆ‡éƒ¨è½æ ¼å°ˆæ¡ˆåˆ†é›¢
2. **å¯æ“´å±•æ€§**ï¼šAdapter æ¨¡å¼æ”¯æ´å¤šæ¡†æ¶
3. **è‡ªå‹•åŒ–**ï¼šGit æ“ä½œå…¨è‡ªå‹•
4. **éŒ¯èª¤è™•ç†**ï¼šå®Œå–„çš„å›æ»¾æ©Ÿåˆ¶
5. **æ¸¬è©¦å‹å–„**ï¼šä¾è³´æ³¨å…¥ï¼Œæ˜“æ–¼æ¸¬è©¦

### æŠ€è¡“æ£§

- **å‰ç«¯**ï¼šVue 3 + TypeScript
- **ç‹€æ…‹ç®¡ç†**ï¼šPinia
- **Git æ“ä½œ**ï¼šsimple-git
- **æª”æ¡ˆç³»çµ±**ï¼šfs-extra
- **Markdown**ï¼šmarkdown-it (ç¾æœ‰)

### æœªä¾†æ“´å±•

- [ ] Hugo Adapter
- [ ] Hexo Adapter
- [ ] Jekyll Adapter
- [ ] è‡ªè¨‚ Adapterï¼ˆç”¨æˆ¶å¯é…ç½®ï¼‰
- [ ] ç™¼å¸ƒé è¦½ï¼ˆé¡¯ç¤ºå°‡è¦æäº¤çš„è®Šæ›´ï¼‰
- [ ] ç™¼å¸ƒæ­·å²è¨˜éŒ„
- [ ] æ‰¹é‡ç™¼å¸ƒ
