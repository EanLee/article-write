# 圓桌會議 #007：Frontmatter 時間欄位命名與語意釐清

> **話題編號**: #007
> **發起日期**: 2026-02-14
> **狀態**: 🔄 討論中
> **相關話題**: [#006 發布機制落差確認](./2026-02-14-publish-mechanism-clarification.md)

---

## 📋 議題描述

目前 WriteFlow 的 Frontmatter 中與時間相關的欄位為：

- `date`：現行語意為「公開/發佈時間」，但命名容易誤解為「建立時間」
- `lastmod`：最後修改時間

**問題**：`date` 這個欄位名稱語意模糊，需要與現有部落格框架（Astro 等）保持相容，但這也造成開發者踩坑。

**觸發點**：開發者需要新增「建立時間」欄位，發現三個時間欄位（建立、發佈、修改）目前只有兩個，且命名不清。

**核心問題**：讓使用者「痛一次」，將欄位名稱改得明確，要求部落格端做對應調整——這個代價值不值得？

**範圍**：
- ✅ 包含：Frontmatter 時間欄位的命名與語意定義
- ✅ 包含：是否新增建立時間欄位
- ✅ 包含：對部落格框架的影響評估
- ❌ 不包含：WriteFlow 內部資料結構（Article interface）的設計

---

## 💬 討論記錄

### 第一輪討論 (2026-02-14)

#### 🎯 PM (Alex) 的觀點

**立場**: ⚠️ 條件支持

**理由**:
1. 命名清晰是長期可維護性的基礎，技術債會複利累積
2. 目前使用者基數還小，現在改比之後改成本低很多
3. 「痛一次」的說法本身就透露出問題——若命名正確，根本不需要開發者額外記憶

**具體建議**:
- 支持改名，但前提是 WriteFlow 提供明確的移轉說明
- 不應該讓使用者自己去查哪個欄位對應到哪個

**潛在風險/機會**:
- 風險：已有文章的使用者需要手動更新 frontmatter，或 WriteFlow 提供自動移轉
- 機會：趁早建立清晰的欄位語意，日後功能擴充有明確基礎

**優先級評估**: P1

---

#### 👤 User (Jordan) 的觀點

**立場**: ✅ 支持

**理由**:
1. 身為使用者，我在 Obsidian 直接編輯 frontmatter 時，`date` 這個名字讓我不確定要填什麼
2. 「發佈前可以是空值」這件事在 `date` 命名下根本看不出來
3. 如果有三個清楚命名的欄位，我在使用 Obsidian 時也更知道怎麼填

**具體建議**:
- 明確命名：`created`（建立）、`published`（發佈）、`lastmod`（修改）
- 若部落格端需要調整，WriteFlow 應該提供說明文件或範例設定

**使用場景**:
- 每次在 Obsidian 寫完文章要填 frontmatter 時都要停下來想「`date` 是哪個時間點」

**期待程度**: ⭐⭐⭐⭐⭐

---

#### 🔧 Ops/Tech Lead (Sam) 的觀點

**立場**: ✅ 支持，但需要釐清部落格端的影響

**理由**:
1. `date` 造成了實際的開發事故——上一輪我們就因為語意不清導致錯誤修復
2. 技術面：Astro 的 content schema 是在部落格端定義的，WriteFlow 輸出什麼欄位名，部落格端的 `content/config.ts` 就要對應更新
3. 這不是 WriteFlow 單方面能決定的——需要確認使用者的部落格端需要改哪些地方

**具體建議**:
- 採用語意明確的三欄位設計：`created`、`pubDate`（發佈時間，沿用 Astro 常見欄位名）、`lastmod`
- 在 `GOTCHAS.md` 和使用者文件中說明對應關係
- WriteFlow 同步時，將 `pubDate` 輸出到目標 `.md`；部落格端 schema 讀取 `pubDate`

**技術風險**:
- 現有使用者文章的 `date` 欄位需要重命名，可考慮提供一鍵移轉功能
- 部落格框架設定調整是使用者自行負責，WriteFlow 提供範例

**可行性評估**: 高

---

#### 💻 CTO (Taylor) 的觀點

**立場**: ✅ 支持，主張一次到位

**理由**:
1. 三個時間點本來就有三個不同語意，用兩個欄位硬撐必然產生混淆
2. Astro 本身推薦的欄位是 `pubDate`（非 `date`），目前我們用 `date` 反而是在偏離主流框架慣例
3. `lastmod` 語意清楚可以保留，不需要改

**具體建議**:
- **建立時間**：`created`（WriteFlow 在文章建立或首次開啟時自動填入，之後不覆蓋）
- **發佈時間**：`pubDate`（同步輸出時自動填入，已有值則沿用）
- **修改時間**：`lastmod`（保持現狀）
- 部落格端 Astro schema 對應：`pubDate: z.string().optional()` 即可

**技術評估**:
- 開發時間：低（主要是欄位名替換 + Article interface 更新）
- 技術難度：🟢 簡單
- 技術債影響：高（修正後欄位語意清晰，往後無需額外記憶）
- ROI：⭐⭐⭐⭐⭐

**替代技術方案**: 維持 `date`，但代價是持續的語意混淆與踩坑

---

### 第二輪討論：互相回應

**Sam 回應 Taylor（`pubDate` vs `publishedAt`）**:
同意用 `pubDate`。理由：Astro 官方範例本身就用 `pubDate`，使用者的部落格 schema 大概率已經有這個欄位，改動成本最小。

**Jordan 回應 Taylor（自動填入 `created`）**:
自動填入的時機很重要——應該是「文章在 WriteFlow 中首次開啟」時填入，而非建立檔案時，因為使用者可能是把已有的 Obsidian 文章匯入。開啟時若沒有 `created` 就補，這樣老文章也能被處理到。

**Alex 回應所有人（移轉問題）**:
既然現在使用者還少，暫不做自動移轉工具，改用文件說明即可。但 WriteFlow 本身輸出的 frontmatter 必須立刻採用新欄位名。

---

## 📊 觀點總結

| 角色 | 立場 | 核心論點 |
|------|------|---------|
| PM (Alex) | ⚠️ 條件支持 | 現在改成本最低，需提供移轉說明 |
| User (Jordan) | ✅ 支持 | `date` 命名讓使用者困惑，三欄位語意清楚 |
| Ops/Sam | ✅ 支持 | 語意不清已造成實際事故，確認部落格端影響後改 |
| CTO (Taylor) | ✅ 支持 | 一次到位，`pubDate` 符合 Astro 慣例，ROI 高 |

---

## 🤝 共識與分歧

### 共識點

- `date` 命名語意不清，需要改
- 三個時間點應有三個欄位：建立、發佈、修改
- `lastmod` 語意清楚，不需要動
- 建立時間（`created`）應在文章首次於 WriteFlow 開啟時自動填入，已有值不覆蓋
- 發佈時間採用 `pubDate`（符合 Astro 慣例）

### 主要分歧

無。四角色均支持改名。

### 待釐清問題

- ❓ 部落格端 Astro schema 範例是否需要整理進文件？

---

## 📝 決策

**決策類型**: 全體一致

### 欄位定義（新）

| 欄位 | 語意 | 填入時機 | 必填 |
|------|------|---------|------|
| `created` | 建立時間 | WriteFlow 首次開啟文章時自動填入 | 否（自動補） |
| `pubDate` | 公開/發佈時間 | 同步輸出時自動填入；已有值則沿用 | 否（同步時補） |
| `lastmod` | 最後修改時間 | 保持現狀 | 否 |

### 自動移轉機制（降低轉換成本）

為減輕已有 Obsidian 文章的使用者的轉換負擔，WriteFlow 在**開啟文章時**執行自動檢查與轉換：

| 偵測條件 | 自動處理 |
|---------|---------|
| frontmatter 無 `created` | 自動填入當下時間並寫回檔案 |
| frontmatter 有 `date`，無 `pubDate` | 將 `date` 值複製到 `pubDate`，移除 `date` |
| frontmatter 有 `date` 且有 `pubDate` | 保留 `pubDate`，移除 `date` |
| frontmatter 無 `date` 也無 `pubDate` | 不處理（同步輸出時再填） |
| frontmatter 已是 `pubDate` | 不處理 |

**原則**：自動轉換，但**不改變語意**——`date` 的值原本就是發佈時間，移轉到 `pubDate` 是正確對應。

**說明文件**：在 WriteFlow 設定頁或首次開啟時顯示一次性提示，告知使用者已自動移轉欄位名稱，部落格端 schema 需對應調整（附上說明連結）。

### 行動項目

- [ ] Lin：`Frontmatter` interface 新增 `created?: string`，移除 `date`，改為 `pubDate?: string`
- [ ] Lin：`PublishService.convertFrontmatter()` 處理 `pubDate`（原 `date` 邏輯移至此）
- [ ] Lin：`setCurrentArticle()` 執行三件事：
  - 若無 `created`，自動填入當下時間並寫回檔案
  - 若有 `date`（舊欄位），自動移轉至 `pubDate` 並寫回檔案
- [ ] Sam：更新 `docs/dev-notes/GOTCHAS.md` 反映新欄位定義與移轉邏輯
- [ ] Sam：更新 `docs/architecture/E2E_PUBLISH_FLOW.md` 中的 frontmatter 說明

---

**最後更新**: 2026-02-14
