# T-009 å…¨æ–‡æœå°‹åŠŸèƒ½è¨­è¨ˆ

**æ—¥æœŸ**: 2026-02-16
**è² è²¬äºº**: Linï¼ˆServices Engineerï¼‰
**ç‹€æ…‹**: ðŸš§ é€²è¡Œä¸­

## ä»»å‹™èƒŒæ™¯

åœ“æ¡Œ #013 æ±ºç­–ï¼šå…¨æ–‡æœå°‹ç‚º v0.2 å¾ŒåŠ Sprint P0 åŠŸèƒ½ã€‚
Jordanï¼ˆUserï¼‰æ¯å¤© 2~3 æ¬¡å› æ‰¾ä¸åˆ°èˆŠæ–‡ç« å…§å®¹è€Œå›°æ“¾ã€‚

**åœ“æ¡Œæ±ºç­–é‡é»ž**ï¼š
- æœ¬åœ° markdown æª”ï¼ŒNode.js `fs` + regexï¼Œä¸éœ€æœå°‹å¼•æ“Ž
- ç´¢å¼•è¨­è¨ˆé ç•™ wikilink æ“´å……ç©ºé–“ï¼ˆç‚º topic-014 æ–‡ç« é–“é€£çµæ‰“åŸºç¤Žï¼‰
- æœå°‹çµæžœ scroll-to CM6 Editor å…ˆç•™ stubï¼Œå¾… CM6 scroll-to API ç¢ºèªç©©å®š

## è¨Žè«–è¨˜éŒ„

### ç¬¬ä¸€è¼ª (2026-02-16)

Samï¼šã€Œå¥½ï¼Œä»Šå¤© T-009 å…¨æ–‡æœå°‹ï¼Œæ ¸å¿ƒå•é¡Œä¸‰å€‹ï¼šç´¢å¼•ä½åœ¨å“ªã€ä»€éº¼æ™‚æ©Ÿå»ºç«‹æˆ–é‡å»ºã€æœå°‹è«‹æ±‚èµ°å“ªæ¢è·¯ã€‚ä»Šå¤©è¦æ±ºå®šï¼šç´¢å¼•å„²å­˜ä½ç½®ã€è§¸ç™¼é‡å»ºæ™‚æ©Ÿã€IPC channel è¨­è¨ˆã€‚Linï¼ŒSearchService è¦ç¨ç«‹å‡ºä¾†ï¼Œé‚„æ˜¯ç›´æŽ¥æ“´å…… MetadataCacheServiceï¼Ÿã€

Linï¼šã€Œææ¡ˆå¦‚ä¸‹â€”â€”ç´¢å¼•è³‡æ–™çµæ§‹æ¯ç­†å­˜ï¼š`filePath`ã€`title`ã€`tags`ã€`category`ã€`status`ã€`wikilinks`ï¼ˆ`string[]`ï¼Œå…ˆæŽƒ `[[...]]` å¡žé€²ä¾†å‚™ç”¨ï¼‰ã€`contentSnippet`ï¼ˆåŽ»æŽ‰ markdown èªžæ³•çš„ç´”æ–‡å­—ï¼‰ã€`updatedAt`ã€‚å­˜æ”¾ä½ç½®å»ºè­°**ç¨ç«‹**ï¼š`articlesDir/.writeflow/search-index.json`ã€‚metadata-cache å¡žå…§æ–‡æ‘˜è¦æœƒè®Šè‚¥ã€è·è²¬ä¸æ¸…æ¥šï¼Œå…©å€‹æª”æ¡ˆå„è‡ªå–®ç´”ã€‚å»ºç«‹æ™‚æ©Ÿï¼š**å•Ÿå‹•å…¨é‡å»ºï¼Œä¹‹å¾Œå¢žé‡æ›´æ–°**ï¼ˆchokidar `add`/`change`/`unlink`ï¼‰ã€‚Lazy ä¸è€ƒæ…®ï¼Œæœå°‹æ˜¯é«˜é »æ“ä½œï¼Œç¬¬ä¸€æ¬¡æ‰å»ºæœƒè®“ä½¿ç”¨è€…ç­‰ã€‚IPC handlerï¼š`search:query`ï¼Œé€ `{ query, filters? }`ï¼Œå›žå‚³ `{ filePath, title, matchSnippet, score }[]`ï¼Œscore å…ˆç”¨ match æ¬¡æ•¸æŽ’åºã€‚ã€

Weiï¼šã€Œå¿«æ·éµ `Cmd/Ctrl+Shift+F` é–‹ modal overlayï¼Œä¸ä½”å¸¸é§ç‰ˆé¢ã€‚æ¯ç­†é¡¯ç¤ºæ¨™é¡Œ + snippetï¼ˆå‰å¾Œç´„ 50 å­—ï¼‰+ é—œéµå­—é«˜äº®ã€‚é»žæ“Šå¾Œåˆ‡æ›æ–‡ç« ï¼Œscroll-to å…ˆåš `scrollToMatch(index)` stubï¼ŒUI ä¿ç•™æŒ‰éˆ•ï¼ŒCM6 ä¸²æŽ¥å¾Œå¡«å¯¦ä½œã€‚Alexï¼Œmodal é–‹è‘—åº•å±¤ç·¨è¼¯å™¨è¦ dim å—Žï¼Ÿçµæžœåˆ—è¡¨è¦æ”¯æ´éµç›¤ä¸Šä¸‹é¸å—Žï¼Ÿã€

Alexï¼šã€Œæœå°‹å…¥å£å»ºè­° `Cmd/Ctrl+F` æµ®å‹•é¢æ¿ï¼ŒJordan åœ¨å¯«ä½œä¸­é€”æ‰¾æ±è¥¿ï¼Œä¸æ‡‰è©²åˆ‡æ›ç‰ˆé¢ä¸Šä¸‹æ–‡ã€‚æ¯ç­†è¦é¡¯ç¤ºï¼šæ¨™é¡Œã€æ—¥æœŸã€å‘½ä¸­æ®µè½å‰å¾Œå…©è¡Œâ€”â€”å…‰æ¨™é¡Œåˆ¤æ–·ä¸äº†ã€Žé€™ç¯‡æ˜¯ä¸æ˜¯æˆ‘è¦çš„ã€ã€‚é«˜äº®ç”¨ DaisyUI `warning` è‰²ï¼Œä½†åªé«˜äº®ç•¶å‰é¸ä¸­é‚£ç­†ï¼Œå…¶ä»–ä½Žé£½å’Œåº¦ï¼Œç„¦é»žè¦é›†ä¸­ã€‚**UX é™·é˜±**ï¼šJordan çš„çœŸå¯¦éœ€æ±‚æ˜¯ã€Žä¸Šé€±å¯«çš„ã€ï¼Œé è¨­æŽ’åºæ‡‰è©²æ˜¯**æ™‚é–“å€’åº**ï¼Œç›¸é—œåº¦æ˜¯æ¬¡é¸ã€‚Wei å¦‚æžœåªåšç›¸é—œåº¦æŽ’åºï¼ŒJordan ä¸€å®šæ‰¾ä¸åˆ°ã€‚ã€

---

### ç¬¬äºŒè¼ª (2026-02-16)

Samï¼šã€Œå¥½ï¼Œæˆ‘ä¾†æ‹æ¿ã€‚SearchService ç¨ç«‹å»ºï¼ŒMetadataCacheService è·è²¬å·²å¤ é‡ï¼Œå¡žæœå°‹é€²åŽ»é•å SRPã€‚æŽ’åºé è¨­æ™‚é–“å€’åºâ€”â€”Alex èªªå¾—å°ï¼Œä½¿ç”¨è€…é€šå¸¸æ‰¾æœ€è¿‘çš„ï¼Œscore åšæˆåˆ‡æ›é¸é …ä½†ä¸é è¨­ã€‚å¿«æ·éµ `Cmd/Ctrl+F`ï¼ŒNotionã€Obsidian éƒ½é€™æ¨£ï¼Œé™ä½Žå­¸ç¿’æˆæœ¬ã€‚é‚„æœ‰ä¸€å€‹æ²’äººæåˆ°ï¼šsearch-index.json è¦ persist å—Žï¼Ÿé‚„æ˜¯æ¯æ¬¡å•Ÿå‹•éƒ½é‡å»ºï¼Ÿcold start æ•ˆèƒ½é æœŸè¦èªªæ¸…æ¥šã€‚ã€

Weiï¼šã€Œæµ®å‹•é¢æ¿ã€ä¸ dimï¼Œç¢ºèªæŽ¡ç”¨ã€‚éµç›¤ä¸Šä¸‹é¸æ”¯æ´â€”â€”`â†‘â†“` å°Žèˆªã€`Enter` é–‹å•Ÿï¼ŒåŸºæœ¬å¯ç”¨æ€§ã€‚Linï¼ŒIPC response è£œ `updatedAt`ï¼ˆtimestampï¼‰ï¼Œé è¨­æ™‚é–“å€’åºæŽ’åºè¦é é€™å€‹ã€‚`score` ç•™è‘—çµ¦ç›¸é—œåº¦åˆ‡æ›ç”¨ã€‚å¿«æ·éµæ”¹ `Cmd/Ctrl+F`ï¼Œæ²’å•é¡Œã€‚ã€

Linï¼šã€Œ`updatedAt` åŠ é€²åŽ»ã€‚`matchSnippet` åªå›žå‚³ç¬¬ä¸€å€‹å‘½ä¸­ç‰‡æ®µï¼Œå›žå‚³é™£åˆ— UI ç«¯è¤‡é›œå¾ˆå¤šã€‚æš«å®šåž‹åˆ¥ï¼š`{ id, title, matchSnippet, updatedAt, category, status }`ã€‚Weiï¼Œé€™æ¨£æ¬„ä½å¤ ç”¨å—Žï¼Ÿã€

---

### ç¬¬ä¸‰è¼ª (2026-02-16)

Linï¼šã€Œå»ºè­°æ¯æ¬¡å•Ÿå‹•é‡å»ºï¼Œä¸ persistã€‚å€‹äººéƒ¨è½æ ¼é ‚å¤šå¹¾ç™¾ç¯‡ï¼Œå…¨é‡æŽƒæå¯¦æ¸¬ç´„ 200â€“500msï¼Œç¶­è­· persist æ©Ÿåˆ¶çš„è¤‡é›œåº¦å®Œå…¨ä¸æˆæ¯”ä¾‹ã€‚MetadataCacheService å·²æœ‰ metadata cacheï¼Œsearch index å¾ž cache ç›´æŽ¥å»ºç«‹å°±å¤ å¿«ã€‚cold start çš„ç“¶é ¸ä¸åœ¨é€™è£¡ã€‚ã€

Weiï¼šã€Œæ¬„ä½åŸºæœ¬å¤ ç”¨ï¼Œä½†éœ€è¦è£œ `filePath`â€”â€”å…‰é  `id` é‚„è¦å†æŸ¥ä¸€æ¬¡æ‰çŸ¥é“é–‹å“ªå€‹æª”æ¡ˆï¼Œç›´æŽ¥å¸¶ `filePath` ä¹¾æ·¨å¤šäº†ã€‚å…¶ä»–æ¬„ä½éƒ½ç”¨å¾—åˆ°ã€‚ã€

---

## è¨­è¨ˆæ±ºç­–

### æž¶æ§‹

| é …ç›® | æ±ºå®š | ç†ç”± |
|------|------|------|
| SearchService | ç¨ç«‹å»ºç«‹ï¼Œä¸æ“´å…… MetadataCacheService | SRPï¼Œè·è²¬æ¸…æ¥šï¼Œæ—¥å¾Œæ›æœå°‹ç®—æ³•ä¸å½±éŸ¿ metadata |
| ç´¢å¼• persistence | ä¸ persistï¼Œæ¯æ¬¡å•Ÿå‹•é‡å»º | å¹¾ç™¾ç¯‡æ–‡ç« å…¨é‡æŽƒæç´„ 200â€“500msï¼Œç¶­è­· persist è¤‡é›œåº¦ä¸æˆæ¯”ä¾‹ |
| ç´¢å¼•å»ºç«‹æ™‚æ©Ÿ | å•Ÿå‹•æ™‚å…¨é‡å»ºï¼Œä¹‹å¾Œ chokidar å¢žé‡æ›´æ–° | é«˜é »æ“ä½œä¸èƒ½ lazy |
| å­˜æ”¾ä½ç½® | è¨˜æ†¶é«”ï¼ˆä¸å­˜æª”ï¼‰ | å¾ž MetadataCacheService çš„ metadata ç›´æŽ¥å»ºç«‹ |
| é è¨­æŽ’åº | **æ™‚é–“å€’åº**ï¼ˆ`updatedAt`ï¼‰ | Jordan é€šå¸¸æ‰¾æœ€è¿‘çš„æ–‡ç« ï¼›ç›¸é—œåº¦æŽ’åºåšæˆåˆ‡æ›é¸é … |
| å¿«æ·éµ | `Cmd/Ctrl+F` | ç¬¦åˆ Notionã€Obsidian ä¸»æµæ…£ä¾‹ |

### UI è¨­è¨ˆ

| é …ç›® | æ±ºå®š |
|------|------|
| å…¥å£ | æµ®å‹•é¢æ¿ overlayï¼Œä¸ä½”å¸¸é§ç‰ˆé¢ |
| åº•å±¤ dim | ä¸ dimï¼Œä¸æ‰“æ–·å¯«ä½œä¸Šä¸‹æ–‡ |
| æ¯ç­†é¡¯ç¤º | æ¨™é¡Œ + æ—¥æœŸ + å‘½ä¸­æ®µè½å‰å¾Œå…©è¡Œ |
| é«˜äº® | DaisyUI `warning` è‰²ï¼›åªé«˜äº®ç•¶å‰é¸ä¸­ç­†ï¼Œå…¶ä»–ä½Žé£½å’Œåº¦ |
| éµç›¤å°Žèˆª | `â†‘â†“` é¸æ“‡ï¼Œ`Enter` é–‹å•Ÿ |
| scroll-to | å…ˆå¯¦ä½œ `scrollToMatch(index)` stubï¼ŒCM6 API ç¢ºèªå¾Œå¡«å…¥ |

### IPC è¨­è¨ˆ

**Handler**ï¼š`search:query`

**Request**ï¼š
```typescript
interface SearchQuery {
  query: string
  filters?: {
    category?: string
    status?: ArticleStatus
    tags?: string[]
  }
}
```

**Response**ï¼š
```typescript
interface SearchResult {
  id: string
  filePath: string      // è·³è½‰ç›´æŽ¥ç”¨
  title: string
  matchSnippet: string  // ç¬¬ä¸€å€‹å‘½ä¸­ç‰‡æ®µï¼Œå«å‰å¾Œæ–‡
  updatedAt: string     // ISO 8601ï¼Œé è¨­æŽ’åºä¾æ“š
  category: ArticleCategory
  status: ArticleStatus
}
```

### wikilink æ“´å……é ç•™

ç´¢å¼•å»ºç«‹æ™‚ï¼ŒåŒæ­¥è§£æžæ¯ç¯‡æ–‡ç« çš„ `[[...]]` èªžæ³•ä¸¦å­˜å…¥è¨˜æ†¶é«”ï¼ˆç¨ç«‹ Mapï¼‰ï¼Œä¾›æœªä¾† topic-014 æ–‡ç« é–“é€£çµåŠŸèƒ½ä½¿ç”¨ï¼Œå…±ç”¨åŒä¸€æ¬¡å…¨é‡æŽƒæã€‚

## å¯¦ä½œèªªæ˜Ž

**æª”æ¡ˆçµæ§‹ï¼ˆé è¨ˆï¼‰**ï¼š
```
src/main/services/SearchService.ts     â† æ–°å»º
src/renderer/stores/search.ts          â† æ–°å»º
src/components/SearchPanel.vue         â† æ–°å»º
```

**å•Ÿå‹•æµç¨‹**ï¼š
1. Main process å•Ÿå‹•å¾Œï¼Œ`SearchService.buildIndex()` è®€å– MetadataCache çš„æ–‡ç« åˆ—è¡¨
2. é€ç¯‡è®€å– `contentSnippet`ï¼ˆåŽ» markdown èªžæ³•çš„ç´”æ–‡å­—ï¼‰
3. ç›£è½ chokidar äº‹ä»¶åšå¢žé‡æ›´æ–°
4. IPC handler `search:query` åœ¨è¨˜æ†¶é«”ç´¢å¼•ä¸­ regex æœå°‹å¾Œå›žå‚³

## ç›¸é—œæª”æ¡ˆ

- `src/main/services/MetadataCacheService.ts`ï¼ˆä¾è³´ä¾†æºï¼‰
- `src/main/services/FileService.ts`ï¼ˆfs æ“ä½œï¼‰
- `src/components/CodeMirrorEditor.vue`ï¼ˆscroll-to stub æ•´åˆé»žï¼‰

## ç›¸é—œ Commit

> å¾…å¯¦ä½œå¾Œè£œå……
