<template>
  <div v-if="modelValue" class="modal modal-open">
    <div class="modal-box w-11/12 max-w-5xl max-h-[90vh] flex flex-col">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6 flex-shrink-0">
        <div>
          <h3 class="text-2xl font-bold">éƒ¨è½æ ¼è¨­å®š</h3>
          <p class="text-sm text-base-content/60 mt-1">é…ç½®æ‚¨çš„éƒ¨è½æ ¼å¯«ä½œèˆ‡ç™¼å¸ƒç’°å¢ƒ</p>
        </div>
        <button class="btn btn-sm btn-circle btn-ghost" @click="handleClose">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Tabs -->
      <div role="tablist" class="tabs tabs-boxed mb-6 bg-base-200 flex-shrink-0">
        <a 
          role="tab" 
          class="tab"
          :class="{ 'tab-active': activeTab === 'basic' }"
          @click="activeTab = 'basic'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
          </svg>
          åŸºæœ¬è¨­å®š
        </a>
        <a 
          role="tab" 
          class="tab"
          :class="{ 'tab-active': activeTab === 'framework' }"
          @click="activeTab = 'framework'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          éƒ¨è½æ ¼æ¡†æ¶
        </a>
        <a
          role="tab"
          class="tab"
          :class="{ 'tab-active': activeTab === 'editor' }"
          @click="activeTab = 'editor'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          ç·¨è¼¯å™¨
        </a>
        <a
          role="tab"
          class="tab"
          :class="{ 'tab-active': activeTab === 'ai' }"
          @click="activeTab = 'ai'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m1.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
          AI è¨­å®š
        </a>
        <a
          role="tab"
          class="tab relative"
          :class="{ 'tab-active': activeTab === 'git' }"
          @click="activeTab = 'git'"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
          Git ç™¼å¸ƒ
          <span class="badge badge-xs badge-warning ml-1">å³å°‡æ¨å‡º</span>
        </a>
      </div>

      <!-- Tab Content -->
      <div class="flex-1 overflow-y-auto">
        <!-- Basic Settings Tab -->
        <div v-show="activeTab === 'basic'" class="space-y-4">
          <!-- Articles Directory Card -->
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <div class="flex items-start gap-3">
                <div class="rounded-full bg-primary/10 p-2 mt-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h4 class="font-semibold text-lg">æ–‡ç« è³‡æ–™å¤¾</h4>
                    <span class="badge badge-error badge-sm">å¿…å¡«</span>
                  </div>
                  <p class="text-sm text-base-content/70 mb-3">
                    å­˜æ”¾æ‚¨çš„ Markdown æ–‡ç« çš„è³‡æ–™å¤¾ï¼ˆæ”¯æ´ Wiki Link èªæ³•ï¼‰
                  </p>
                  <div class="join w-full">
                    <input
                      v-model="localConfig.paths.articlesDir"
                      type="text"
                      placeholder="ä¾‹å¦‚ï¼šC:\Users\ä½ çš„åå­—\Documents\Blog\articles"
                      class="input input-bordered join-item flex-1"
                      :class="{ 'input-error': localConfig.paths.articlesDir && !articlesValidation.valid }"
                    />
                    <button class="btn btn-primary join-item" @click="selectArticlesPath">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z" />
                      </svg>
                      é¸æ“‡è³‡æ–™å¤¾
                    </button>
                  </div>
                  <div v-if="localConfig.paths.articlesDir" class="flex items-center gap-2 mt-2">
                    <div 
                      class="w-3 h-3 rounded-full"
                      :class="articlesValidation.valid ? 'bg-success' : 'bg-warning'"
                    ></div>
                    <span class="text-xs" :class="articlesValidation.valid ? 'text-success' : 'text-warning'">
                      {{ articlesValidation.message }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Blog Directory Card -->
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <div class="flex items-start gap-3">
                <div class="rounded-full bg-secondary/10 p-2 mt-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-secondary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                  </svg>
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h4 class="font-semibold text-lg">éƒ¨è½æ ¼å°ˆæ¡ˆè·¯å¾‘</h4>
                    <span class="badge badge-ghost badge-sm">é¸å¡«</span>
                  </div>
                  <p class="text-sm text-base-content/70 mb-3">
                    æ–‡ç« è¼¸å‡ºç›®æ¨™è³‡æ–™å¤¾ï¼ˆç›´æ¥æŒ‡å‘ content è³‡æ–™å¤¾ï¼Œä¾‹å¦‚ Astro çš„ <code class="font-mono text-xs bg-base-300 px-1 rounded">src/content/blog</code>ï¼‰
                  </p>
                  <div class="join w-full">
                    <input
                      v-model="localConfig.paths.targetBlog"
                      type="text"
                      placeholder="ä¾‹å¦‚ï¼šC:\Users\ä½ çš„åå­—\Projects\my-blog\src\content\blog"
                      class="input input-bordered join-item flex-1"
                      :class="{ 'input-error': localConfig.paths.targetBlog && !blogValidation.valid && !blogValidation.warning }"
                    />
                    <button class="btn btn-primary join-item" @click="selectBlogPath">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z" />
                      </svg>
                      é¸æ“‡è³‡æ–™å¤¾
                    </button>
                  </div>
                  <div v-if="localConfig.paths.targetBlog" class="flex items-center gap-2 mt-2">
                    <div
                      class="w-3 h-3 rounded-full"
                      :class="blogValidation.valid && !blogValidation.warning ? 'bg-success' : blogValidation.warning ? 'bg-warning' : 'bg-error'"
                    ></div>
                    <span class="text-xs" :class="blogValidation.valid && !blogValidation.warning ? 'text-success' : blogValidation.warning ? 'text-warning' : 'text-error'">
                      {{ blogValidation.message }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Images Directory Card -->
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <div class="flex items-start gap-3">
                <div class="rounded-full bg-accent/10 p-2 mt-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h4 class="font-semibold text-lg">åœ–ç‰‡è³‡æ–™å¤¾</h4>
                    <span class="badge badge-ghost badge-sm">é¸å¡«</span>
                  </div>
                  <p class="text-sm text-base-content/70 mb-3">
                    çµ±ä¸€ç®¡ç†æ‚¨çš„æ–‡ç« åœ–ç‰‡ï¼ˆç•™ç©ºå‰‡è‡ªå‹•ä½¿ç”¨ æ–‡ç« è³‡æ–™å¤¾/imagesï¼‰
                  </p>
                  <div class="join w-full">
                    <input
                      v-model="localConfig.paths.imagesDir"
                      type="text"
                      placeholder="ç•™ç©ºä½¿ç”¨é è¨­è·¯å¾‘"
                      class="input input-bordered join-item flex-1"
                    />
                    <button class="btn btn-outline join-item" @click="selectImagesPath">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z" />
                      </svg>
                      é¸æ“‡è³‡æ–™å¤¾
                    </button>
                  </div>
                  <div v-if="!localConfig.paths.imagesDir && localConfig.paths.articlesDir" class="alert alert-info mt-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-sm">å°‡ä½¿ç”¨é è¨­è·¯å¾‘ï¼š{{ localConfig.paths.articlesDir }}\images</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Setup Guide -->
          <div class="alert">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-info shrink-0 w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <h4 class="font-bold">å¿«é€Ÿè¨­å®šæç¤º</h4>
              <div class="text-xs mt-1 space-y-1">
                <p>1. é¸æ“‡ä¸€å€‹è³‡æ–™å¤¾å­˜æ”¾æ‚¨çš„ Markdown æ–‡ç« ï¼ˆå¯ä½¿ç”¨ Wiki Link èªæ³•ï¼‰</p>
                <p>2. éƒ¨è½æ ¼å°ˆæ¡ˆè·¯å¾‘å¯ç¨å¾Œè¨­å®šï¼ˆéœ€è¦æ™‚å†æŒ‡å®šç”¨æ–¼ç™¼å¸ƒï¼‰</p>
                <p>3. åœ–ç‰‡è³‡æ–™å¤¾å¯é¸å¡«ï¼Œç•™ç©ºæœƒè‡ªå‹•å»ºç«‹</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Framework Settings Tab -->
        <div v-show="activeTab === 'framework'" class="space-y-4">
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <h4 class="font-semibold text-lg mb-3">é¸æ“‡éƒ¨è½æ ¼æ¡†æ¶</h4>
              <p class="text-sm text-base-content/70 mb-4">
                é¸æ“‡æ‚¨ä½¿ç”¨çš„éœæ…‹ç¶²ç«™ç”Ÿæˆå™¨ï¼Œæˆ‘å€‘æœƒè‡ªå‹•é©é…å°æ‡‰çš„æª”æ¡ˆçµæ§‹
              </p>
              
              <!-- Astro Option -->
              <div class="form-control">
                <label class="label cursor-pointer justify-start gap-4 p-4 border border-base-300 rounded-lg hover:bg-base-200 transition-colors">
                  <input 
                    type="radio" 
                    name="framework" 
                    value="astro"
                    class="radio radio-primary" 
                    checked 
                    disabled
                  />
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <span class="font-semibold">Astro</span>
                      <span class="badge badge-primary badge-sm">ç›®å‰æ”¯æ´</span>
                    </div>
                    <p class="text-xs text-base-content/60 mt-1">
                      æ”¯æ´ Content Collections çµæ§‹ (src/content/blog/)
                    </p>
                  </div>
                </label>
              </div>

              <!-- Future Frameworks -->
              <div class="divider text-sm text-base-content/50">å³å°‡æ”¯æ´</div>
              
              <div class="space-y-2 opacity-50">
                <div class="form-control">
                  <label class="label cursor-not-allowed justify-start gap-4 p-4 border border-base-300 rounded-lg">
                    <input 
                      type="radio" 
                      name="framework" 
                      value="hugo"
                      class="radio radio-primary" 
                      disabled
                    />
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <span class="font-semibold">Hugo</span>
                        <span class="badge badge-ghost badge-sm">è¦åŠƒä¸­</span>
                      </div>
                      <p class="text-xs text-base-content/60 mt-1">
                        æ”¯æ´ Hugo æ¨™æº–å…§å®¹çµæ§‹ (content/posts/)
                      </p>
                    </div>
                  </label>
                </div>

                <div class="form-control">
                  <label class="label cursor-not-allowed justify-start gap-4 p-4 border border-base-300 rounded-lg">
                    <input 
                      type="radio" 
                      name="framework" 
                      value="hexo"
                      class="radio radio-primary" 
                      disabled
                    />
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <span class="font-semibold">Hexo</span>
                        <span class="badge badge-ghost badge-sm">è¦åŠƒä¸­</span>
                      </div>
                      <p class="text-xs text-base-content/60 mt-1">
                        æ”¯æ´ Hexo æ¨™æº–å…§å®¹çµæ§‹ (source/_posts/)
                      </p>
                    </div>
                  </label>
                </div>

                <div class="form-control">
                  <label class="label cursor-not-allowed justify-start gap-4 p-4 border border-base-300 rounded-lg">
                    <input 
                      type="radio" 
                      name="framework" 
                      value="jekyll"
                      class="radio radio-primary" 
                      disabled
                    />
                    <div class="flex-1">
                      <div class="flex items-center gap-2">
                        <span class="font-semibold">Jekyll</span>
                        <span class="badge badge-ghost badge-sm">è¦åŠƒä¸­</span>
                      </div>
                      <p class="text-xs text-base-content/60 mt-1">
                        æ”¯æ´ Jekyll æ¨™æº–å…§å®¹çµæ§‹ (_posts/)
                      </p>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="alert alert-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="text-sm">æ›´å¤šæ¡†æ¶æ”¯æ´æ­£åœ¨é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼</span>
          </div>
        </div>

        <!-- Editor Settings Tab -->
        <div v-show="activeTab === 'editor'" class="space-y-4">
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <h4 class="font-semibold text-lg mb-4">ç·¨è¼¯å™¨åå¥½è¨­å®š</h4>
              
              <!-- Auto Save -->
              <div class="form-control">
                <label class="label cursor-pointer justify-start gap-4">
                  <input 
                    v-model="localConfig.editorConfig.autoSave"
                    type="checkbox" 
                    class="toggle toggle-primary" 
                  />
                  <div>
                    <span class="label-text font-semibold">è‡ªå‹•å„²å­˜</span>
                    <p class="text-xs text-base-content/60 mt-1">
                      å®šæœŸè‡ªå‹•å„²å­˜æ–‡ç« è®Šæ›´ï¼Œé¿å…æ„å¤–ä¸Ÿå¤±å…§å®¹
                    </p>
                  </div>
                </label>
              </div>

              <!-- Auto Save Interval -->
              <div v-if="localConfig.editorConfig.autoSave" class="form-control ml-12 mt-2">
                <label class="label">
                  <span class="label-text">å„²å­˜é–“éš”</span>
                </label>
                <div class="flex items-center gap-4">
                  <input
                    v-model.number="autoSaveSeconds"
                    type="range"
                    min="10"
                    max="300"
                    step="10"
                    class="range range-primary range-sm flex-1"
                  />
                  <div class="badge badge-primary badge-lg">{{ autoSaveSeconds }} ç§’</div>
                </div>
                <label class="label">
                  <span class="label-text-alt">å»ºè­°ç¯„åœï¼š10-300 ç§’</span>
                </label>
              </div>

              <div class="divider"></div>

              <!-- Theme Selection -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold">ç·¨è¼¯å™¨ä¸»é¡Œ</span>
                </label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                  <label 
                    class="label cursor-pointer p-4 border-2 rounded-lg hover:bg-base-200 transition-colors"
                    :class="localConfig.editorConfig.theme === 'light' ? 'border-primary bg-primary/5' : 'border-base-300'"
                  >
                    <div class="flex items-center gap-3">
                      <input 
                        v-model="localConfig.editorConfig.theme"
                        type="radio" 
                        name="theme" 
                        value="light"
                        class="radio radio-primary" 
                      />
                      <div>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                      </div>
                      <div>
                        <div class="font-semibold">æ·ºè‰²æ¨¡å¼</div>
                        <div class="text-xs text-base-content/60">é©åˆç™½å¤©ä½¿ç”¨</div>
                      </div>
                    </div>
                  </label>

                  <label 
                    class="label cursor-pointer p-4 border-2 rounded-lg hover:bg-base-200 transition-colors"
                    :class="localConfig.editorConfig.theme === 'dark' ? 'border-primary bg-primary/5' : 'border-base-300'"
                  >
                    <div class="flex items-center gap-3">
                      <input 
                        v-model="localConfig.editorConfig.theme"
                        type="radio" 
                        name="theme" 
                        value="dark"
                        class="radio radio-primary" 
                      />
                      <div>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                      </div>
                      <div>
                        <div class="font-semibold">æ·±è‰²æ¨¡å¼</div>
                        <div class="text-xs text-base-content/60">é©åˆå¤œé–“ä½¿ç”¨</div>
                      </div>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Settings Tab -->
        <div v-show="activeTab === 'ai'" class="space-y-4">

          <!-- Claude -->
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <h4 class="font-semibold text-lg mb-2">Claude API Key</h4>
              <p class="text-sm text-base-content/70 mb-4">
                è¼¸å…¥æ‚¨çš„ Anthropic API Key ä»¥å•Ÿç”¨ Claude AI åŠŸèƒ½ã€‚
                Key å°‡åŠ å¯†å„²å­˜æ–¼æœ¬æ©Ÿï¼Œä¸æœƒä¸Šå‚³è‡³ä»»ä½•ä¼ºæœå™¨ã€‚
              </p>
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold">API Key</span>
                </label>
                <div class="join w-full">
                  <input
                    v-model="aiApiKey"
                    type="password"
                    placeholder="sk-ant-..."
                    class="input input-bordered join-item flex-1"
                  />
                  <button class="btn btn-primary join-item" @click="saveApiKey('claude')" :disabled="!aiApiKey.trim()">
                    å„²å­˜
                  </button>
                </div>
                <label class="label">
                  <span class="label-text-alt text-success" v-if="aiKeySaved === 'claude'">âœ“ API Key å·²å„²å­˜</span>
                  <span class="label-text-alt text-base-content/50" v-else>{{ claudeKeyStatus }}</span>
                </label>
              </div>
              <div class="alert alert-info mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <p class="text-sm">å‰å¾€ <strong>Anthropic Console</strong> å–å¾— API Key</p>
                  <p class="text-xs text-base-content/60 mt-1">console.anthropic.com â†’ API Keys â†’ Create Key</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Gemini -->
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <h4 class="font-semibold text-lg mb-2">Gemini API Key</h4>
              <p class="text-sm text-base-content/70 mb-4">
                è¼¸å…¥æ‚¨çš„ Google AI Studio API Key ä»¥å•Ÿç”¨ Gemini AI åŠŸèƒ½ã€‚
                Key å°‡åŠ å¯†å„²å­˜æ–¼æœ¬æ©Ÿï¼Œä¸æœƒä¸Šå‚³è‡³ä»»ä½•ä¼ºæœå™¨ã€‚
              </p>
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold">API Key</span>
                </label>
                <div class="join w-full">
                  <input
                    v-model="geminiApiKey"
                    type="password"
                    placeholder="AIza..."
                    class="input input-bordered join-item flex-1"
                  />
                  <button class="btn btn-primary join-item" @click="saveApiKey('gemini')" :disabled="!geminiApiKey.trim()">
                    å„²å­˜
                  </button>
                </div>
                <label class="label">
                  <span class="label-text-alt text-success" v-if="aiKeySaved === 'gemini'">âœ“ API Key å·²å„²å­˜</span>
                  <span class="label-text-alt text-base-content/50" v-else>{{ geminiKeyStatus }}</span>
                </label>
              </div>
              <div class="alert alert-info mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <p class="text-sm">å‰å¾€ <strong>Google AI Studio</strong> å–å¾— API Key</p>
                  <p class="text-xs text-base-content/60 mt-1">aistudio.google.com â†’ Get API Key</p>
                </div>
              </div>
            </div>
          </div>

          <!-- OpenAI -->
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <h4 class="font-semibold text-lg mb-2">OpenAI API Key</h4>
              <p class="text-sm text-base-content/70 mb-4">
                è¼¸å…¥æ‚¨çš„ OpenAI API Key ä»¥å•Ÿç”¨ GPT AI åŠŸèƒ½ã€‚
                Key å°‡åŠ å¯†å„²å­˜æ–¼æœ¬æ©Ÿï¼Œä¸æœƒä¸Šå‚³è‡³ä»»ä½•ä¼ºæœå™¨ã€‚
              </p>
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold">API Key</span>
                </label>
                <div class="join w-full">
                  <input
                    v-model="openaiApiKey"
                    type="password"
                    placeholder="sk-..."
                    class="input input-bordered join-item flex-1"
                  />
                  <button class="btn btn-primary join-item" @click="saveApiKey('openai')" :disabled="!openaiApiKey.trim()">
                    å„²å­˜
                  </button>
                </div>
                <label class="label">
                  <span class="label-text-alt text-success" v-if="aiKeySaved === 'openai'">âœ“ API Key å·²å„²å­˜</span>
                  <span class="label-text-alt text-base-content/50" v-else>{{ openaiKeyStatus }}</span>
                </label>
              </div>
              <div class="alert alert-info mt-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <p class="text-sm">å‰å¾€ <strong>OpenAI Platform</strong> å–å¾— API Key</p>
                  <p class="text-xs text-base-content/60 mt-1">platform.openai.com â†’ API Keys â†’ Create Key</p>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- Git Settings Tab -->
        <div v-show="activeTab === 'git'" class="space-y-4">
          <div class="card bg-base-100 border border-base-300">
            <div class="card-body">
              <h4 class="font-semibold text-lg mb-4">Git ç™¼å¸ƒè¨­å®š</h4>
              <p class="text-sm text-base-content/70 mb-4">
                ç®¡ç†æ–‡ç« ç™¼å¸ƒå¾Œçš„ Git æ“ä½œæµç¨‹
              </p>

              <!-- Current Version Features -->
              <div class="alert alert-success mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <h4 class="font-bold">âœ¨ v0.1 å·²æä¾› Git æ“ä½œæŒ‡å—</h4>
                  <div class="text-xs mt-1">
                    ç™¼å¸ƒæ–‡ç« å¾Œæœƒè‡ªå‹•é¡¯ç¤º Git æ“ä½œæŒ‡ä»¤ï¼Œæä¾›ä¸€éµè¤‡è£½åŠŸèƒ½
                  </div>
                </div>
              </div>

              <!-- Current Features List -->
              <div class="bg-base-200 rounded-lg p-4 mb-4">
                <h5 class="font-semibold mb-3">ç•¶å‰åŠŸèƒ½ (v0.1)</h5>
                <ul class="space-y-2 text-sm">
                  <li class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span><strong>è‡ªå‹•ç”Ÿæˆ Git æŒ‡ä»¤</strong>ï¼šæ ¹æ“šç™¼å¸ƒçš„æ–‡ç« è‡ªå‹•ç”Ÿæˆ addã€commitã€push æŒ‡ä»¤</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span><strong>æ¨™æº–åŒ– Commit Message</strong>ï¼šéµå¾ª Conventional Commits è¦ç¯„</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span><strong>ä¸€éµè¤‡è£½</strong>ï¼šå–®å€‹æŒ‡ä»¤æˆ–å®Œæ•´æŒ‡ä»¤åºåˆ—å‡å¯å¿«é€Ÿè¤‡è£½</span>
                  </li>
                  <li class="flex items-start gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span><strong>æ“ä½œæŒ‡å¼•</strong>ï¼šæ¯å€‹æ­¥é©Ÿéƒ½æœ‰æ¸…æ¥šçš„èªªæ˜</span>
                  </li>
                </ul>
              </div>

              <!-- Future Features Notice -->
              <div class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <h4 class="font-bold">ğŸš€ v0.2 å°‡æ”¯æ´ Git è‡ªå‹•åŒ–</h4>
                  <div class="text-xs mt-1">ä¸‹å€‹ç‰ˆæœ¬å°‡æä¾›ä¸€éµè‡ªå‹•åŸ·è¡Œ Git æ“ä½œçš„åŠŸèƒ½</div>
                </div>
              </div>

              <!-- Preview of Future Features -->
              <div class="space-y-4 mt-6 opacity-50 pointer-events-none">
                <div class="form-control">
                  <label class="label cursor-pointer justify-start gap-4">
                    <input type="checkbox" class="toggle toggle-primary" disabled />
                    <div>
                      <span class="label-text font-semibold">è‡ªå‹• Git Commit</span>
                      <p class="text-xs text-base-content/60 mt-1">ç™¼å¸ƒæ™‚è‡ªå‹•å»ºç«‹ commit</p>
                    </div>
                  </label>
                </div>

                <div class="form-control">
                  <label class="label cursor-pointer justify-start gap-4">
                    <input type="checkbox" class="toggle toggle-primary" disabled />
                    <div>
                      <span class="label-text font-semibold">è‡ªå‹• Git Push</span>
                      <p class="text-xs text-base-content/60 mt-1">commit å¾Œè‡ªå‹•æ¨é€åˆ°é ç«¯</p>
                    </div>
                  </label>
                </div>

                <div class="form-control">
                  <label class="label">
                    <span class="label-text font-semibold">Commit Message æ¨¡æ¿</span>
                  </label>
                  <input
                    type="text"
                    placeholder="publish: {title}"
                    class="input input-bordered"
                    disabled
                  />
                  <label class="label">
                    <span class="label-text-alt">ä½¿ç”¨ {title} ä»£è¡¨æ–‡ç« æ¨™é¡Œ</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="flex justify-between items-center mt-6 pt-4 border-t border-base-300 flex-shrink-0">
        <div class="flex items-center gap-2">
          <button class="btn btn-ghost" @click="resetToDefaults">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
            é‡è¨­ç‚ºé è¨­å€¼
          </button>
          <button class="btn btn-ghost btn-sm" @click="rescanMetadata" :disabled="isScanning">
            <svg v-if="isScanning" class="h-4 w-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
            </svg>
            <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            é‡æ–°æƒæ Metadata
          </button>
          <span v-if="scanMessage" class="text-xs text-base-content/60">{{ scanMessage }}</span>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-ghost" @click="handleClose">å–æ¶ˆ</button>
          <button 
            class="btn btn-primary"
            @click="handleSave"
            :disabled="!canSave"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            å„²å­˜è¨­å®š
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { useConfigStore } from '@/stores/config'
import { useArticleStore } from '@/stores/article'
import { metadataCacheService } from '@/services/MetadataCacheService'
import type { AppConfig } from '@/types'

interface Props {
  modelValue: boolean
  initialTab?: string
}

interface Emits {
  (e: 'update:modelValue', value: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const configStore = useConfigStore()
const articleStore = useArticleStore()
const activeTab = ref('basic')

// AI Settings
const aiApiKey = ref('')
const geminiApiKey = ref('')
const openaiApiKey = ref('')
const aiKeySaved = ref<'claude' | 'gemini' | 'openai' | null>(null)
const claudeKeyStatus = ref('')
const geminiKeyStatus = ref('')
const openaiKeyStatus = ref('')

async function loadAiKeyStatus() {
  if (window.electronAPI) {
    const hasClaude = await window.electronAPI.aiHasApiKey('claude')
    const hasGemini = await window.electronAPI.aiHasApiKey('gemini')
    const hasOpenAI = await window.electronAPI.aiHasApiKey('openai')
    claudeKeyStatus.value = hasClaude ? 'API Key å·²è¨­å®š' : 'å°šæœªè¨­å®š'
    geminiKeyStatus.value = hasGemini ? 'API Key å·²è¨­å®š' : 'å°šæœªè¨­å®š'
    openaiKeyStatus.value = hasOpenAI ? 'API Key å·²è¨­å®š' : 'å°šæœªè¨­å®š'
  }
}

async function saveApiKey(provider: 'claude' | 'gemini' | 'openai') {
  const keyMap = { claude: aiApiKey, gemini: geminiApiKey, openai: openaiApiKey }
  const statusMap = { claude: claudeKeyStatus, gemini: geminiKeyStatus, openai: openaiKeyStatus }
  const key = keyMap[provider].value.trim()
  if (!key) { return }
  await window.electronAPI.aiSetApiKey(provider, key)
  keyMap[provider].value = ''
  statusMap[provider].value = 'API Key å·²è¨­å®š'
  aiKeySaved.value = provider
  setTimeout(() => { aiKeySaved.value = null }, 3000)
}
const localConfig = ref<AppConfig>({
  paths: {
    articlesDir: '',
    targetBlog: '',
    imagesDir: ''
  },
  editorConfig: {
    autoSave: true,
    autoSaveInterval: 30000,
    theme: 'light'
  }
})

// Convert milliseconds to seconds for UI
const autoSaveSeconds = computed({
  get: () => Math.floor(localConfig.value.editorConfig.autoSaveInterval / 1000),
  set: (value: number) => {
    localConfig.value.editorConfig.autoSaveInterval = value * 1000
  }
})

// Validation
const articlesValidation = ref({ valid: false, message: 'è«‹é¸æ“‡è·¯å¾‘' })
const blogValidation = ref<{ valid: boolean; warning?: boolean; message: string }>({ valid: false, message: 'è«‹é¸æ“‡è·¯å¾‘' })

const canSave = computed(() => {
  // åªéœ€è¦æ–‡ç« è³‡æ–™å¤¾å³å¯å„²å­˜ï¼Œéƒ¨è½æ ¼è·¯å¾‘ç‚ºé¸å¡«
  return !!localConfig.value.paths.articlesDir
})

// Metadata scan
const isScanning = ref(false)
const scanMessage = ref('')

async function rescanMetadata() {
  const articlesDir = configStore.config.paths.articlesDir
  if (!articlesDir) {
    scanMessage.value = 'è«‹å…ˆè¨­å®šæ–‡ç« è³‡æ–™å¤¾'
    return
  }
  isScanning.value = true
  scanMessage.value = ''
  try {
    const result = await metadataCacheService.scan(articlesDir)
    scanMessage.value = `å®Œæˆï¼š${result.categories.length} å€‹åˆ†é¡ã€${result.tags.length} å€‹æ¨™ç±¤`
  } catch (e) {
    scanMessage.value = 'æƒæå¤±æ•—ï¼Œè«‹ç¢ºèªæ–‡ç« è³‡æ–™å¤¾æ˜¯å¦æ­£ç¢º'
    console.error(e)
  } finally {
    isScanning.value = false
  }
}

// Methods
async function selectArticlesPath() {
  try {
    if (!window.electronAPI) {
      console.warn('ç€è¦½å™¨æ¨¡å¼ä¸‹ç„¡æ³•é¸æ“‡è³‡æ–™å¤¾')
      return
    }

    const selectedPath = await window.electronAPI.selectDirectory({
      title: 'é¸æ“‡æ–‡ç« è³‡æ–™å¤¾',
      defaultPath: localConfig.value.paths.articlesDir
    })

    if (selectedPath) {
      localConfig.value.paths.articlesDir = selectedPath
      // Auto-set images directory if not already set
      if (!localConfig.value.paths.imagesDir) {
        localConfig.value.paths.imagesDir = selectedPath + '/images'
      }
    }
  } catch (error) {
    console.error('é¸æ“‡è³‡æ–™å¤¾å¤±æ•—:', error)
  }
}

async function selectBlogPath() {
  try {
    if (!window.electronAPI) {
      console.warn('ç€è¦½å™¨æ¨¡å¼ä¸‹ç„¡æ³•é¸æ“‡è³‡æ–™å¤¾')
      return
    }

    const selectedPath = await window.electronAPI.selectDirectory({
      title: 'é¸æ“‡éƒ¨è½æ ¼å°ˆæ¡ˆè³‡æ–™å¤¾',
      defaultPath: localConfig.value.paths.targetBlog
    })

    if (selectedPath) {
      localConfig.value.paths.targetBlog = selectedPath
    }
  } catch (error) {
    console.error('é¸æ“‡è³‡æ–™å¤¾å¤±æ•—:', error)
  }
}

async function selectImagesPath() {
  try {
    if (!window.electronAPI) {
      console.warn('ç€è¦½å™¨æ¨¡å¼ä¸‹ç„¡æ³•é¸æ“‡è³‡æ–™å¤¾')
      return
    }

    const selectedPath = await window.electronAPI.selectDirectory({
      title: 'é¸æ“‡åœ–ç‰‡è³‡æ–™å¤¾',
      defaultPath: localConfig.value.paths.imagesDir
    })

    if (selectedPath) {
      localConfig.value.paths.imagesDir = selectedPath
    }
  } catch (error) {
    console.error('é¸æ“‡è³‡æ–™å¤¾å¤±æ•—:', error)
  }
}

async function validatePaths() {
  // Validate Articles Directory
  if (localConfig.value.paths.articlesDir) {
    try {
      const result = await configStore.validateArticlesDir(localConfig.value.paths.articlesDir)
      articlesValidation.value = result
    } catch {
      articlesValidation.value = { valid: false, message: 'é©—è­‰å¤±æ•—' }
    }
  } else {
    articlesValidation.value = { valid: false, message: 'è«‹é¸æ“‡è·¯å¾‘' }
  }

  // Validate Blog Directory
  if (localConfig.value.paths.targetBlog) {
    try {
      const result = await configStore.validateAstroBlog(localConfig.value.paths.targetBlog)
      blogValidation.value = result
    } catch {
      blogValidation.value = { valid: false, message: 'é©—è­‰å¤±æ•—' }
    }
  } else {
    blogValidation.value = { valid: false, message: 'è«‹é¸æ“‡è·¯å¾‘' }
  }
}

async function handleSave() {
  try {
    await configStore.saveConfig(localConfig.value)
    
    // å¦‚æœè¨­å®šäº†æ–‡ç« è³‡æ–™å¤¾è·¯å¾‘ï¼Œé‡æ–°è¼‰å…¥æ–‡ç« 
    if (localConfig.value.paths.articlesDir) {
      await articleStore.loadArticles()
    }
    
    emit('update:modelValue', false)
  } catch (error) {
    console.error('å„²å­˜è¨­å®šå¤±æ•—', error)
  }
}

function resetToDefaults() {
  localConfig.value = {
    paths: {
      articlesDir: '',
      targetBlog: '',
      imagesDir: ''
    },
    editorConfig: {
      autoSave: true,
      autoSaveInterval: 30000,
      theme: 'light'
    }
  }
  validatePaths()
}

function handleClose() {
  emit('update:modelValue', false)
}

// Watch for path changes to trigger validation
watch(
  () => [localConfig.value.paths.articlesDir, localConfig.value.paths.targetBlog],
  async () => {
    await validatePaths()
  }
)

// Watch for dialog open/close
watch(
  () => props.modelValue,
  async (isOpen) => {
    if (isOpen) {
      // Set active tab (from initialTab prop or default to 'basic')
      activeTab.value = props.initialTab ?? 'basic'
      // Load current config when dialog opens
      localConfig.value = JSON.parse(JSON.stringify(configStore.config))
      await validatePaths()
      await loadAiKeyStatus()
    }
  }
)
</script>

<style scoped>
/* Custom styles if needed */
</style>